import{c as R,r as c,q as P,s as ae,t as Re,v as Te,w as de,x as ue,y as ht,z as Ie,j as r,B as N,n as he,D as me,A as Le,C as fe,E as pe,F as ge,G as _e,H as ve,o as mt,J as ft,K as pt,e as Fe,L as X,g as gt,P as O,m as se,l as z,N as W,O as xe,a as J,p as vt,u as xt}from"./index-BoJ6jZre.js";import{I as We,a as te,m as ne,L as wt}from"./loading-spinner-CmL7t8Bb.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yt=R("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=R("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bt=R("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const St=R("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jt=R("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ct=R("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=R("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dt=R("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=R("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pt=R("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nt=R("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),Mt=["What is this document about?","Give a brief summary of the document?","Explain the key points in this document.","What are the main takeaways?"];function kt(){const[e,n]=c.useState(""),[t,a]=P(ae),[o,l]=c.useState(!1),[i,s]=P(Re),d=Te(de),[m,h]=c.useState(!0),[f,u]=P(ue),[x,v]=P(ht),p=c.useRef(null),[g,w]=P(Ie),[b,y]=c.useState(null),[T,L]=c.useState(Mt),M=localStorage.getItem("token"),_="http://13.50.81.209:8000",H=async()=>{try{y(null),console.log("Fetching documents...");const j=await te.get(`${_}/api/documents`,{headers:{Authorization:`Bearer ${M}`,"Content-Type":"application/json"}});console.log("MY DOCS",j.data.documents),w(j.data.documents)}catch(j){console.error("Error fetching documents:",j)}};c.useEffect(()=>{H()},[]),c.useEffect(()=>{t.documentId&&w(j=>{if(!j.some(D=>D===String(t.documentId))){const D={id:t.documentId,title:`Document_${t.documentId}.pdf`,is_processed:!1,created_at:new Date().toISOString(),content_type:"application/pdf"};return[...j,D]}return j})},[t.documentId]);const S=async j=>{if(j.preventDefault(),!e.trim()||!d)return;y(null);const Q={role:"user",content:e};s(D=>[...D,Q]),n(""),l(!0),h(!1),p.current=new AbortController;try{const D=await fetch(`${_}/api/chat/`,{method:"POST",headers:{Authorization:`Bearer ${M}`,"Content-Type":"application/json"},body:JSON.stringify({message:e,document_ids:g==null?void 0:g.map(A=>`${A==null?void 0:A.id}`),conversation_id:f,stream:!0}),signal:p.current.signal});if(!D.ok){const A=await D.json();throw new Error(A.message||"An error occurred while processing the request")}if(!D.body)throw new Error("No response body");const G=D.body.getReader(),U=new TextDecoder;let De="";for(s(A=>[...A,{role:"assistant",content:""}]);;){const{value:A,done:Pe}=await G.read();if(Pe)break;const ut=U.decode(A,{stream:!0}).split(`
`).map(B=>B.replace(/^data: /,"").trim()).filter(B=>B);for(const B of ut)try{const Y=JSON.parse(B);Y.type==="chunk"&&Y.text&&(De+=Y.text,s(K=>K[K.length-1].role==="assistant"?[...K.slice(0,-1),{role:"assistant",content:De}]:K))}catch(Y){console.error("JSON parse error:",Y)}}(async()=>{try{const A=localStorage.getItem("token"),Ne=await(await fetch(`${_}/api/conversations/`,{headers:{Authorization:`Bearer ${A}`}})).json();v(Ne.conversations)}catch(A){console.error("Failed to fetch conversations:",A)}})()}catch(D){console.error("ðŸš€ ~ handleSubmit ~ error:",D);const G=D.message||"Sorry, something went wrong. Please try again.";y(G),D.name==="AbortError"?s(U=>[...U,{role:"assistant",content:"Request was cancelled."}]):s(U=>[...U,{role:"assistant",content:G}])}finally{l(!1)}},k=()=>{p.current&&(p.current.abort(),l(!1))},F=j=>{n(j),L(Q=>Q.filter(D=>D!==j)),T.length<=1&&h(!1)};return r.jsxs("div",{className:"space-y-3",children:[b&&r.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-2 rounded-md",children:b}),o&&r.jsxs("div",{className:"text-sm text-muted-foreground flex items-center gap-2",children:[r.jsx(Me,{className:"w-4 h-4 animate-spin"}),"Thinking..."]}),m&&T.length>0&&r.jsxs("div",{className:"space-y-2",children:[r.jsx("h3",{className:"font-semibold text-sm text-muted-foreground",children:"Suggested Questions"}),r.jsx("div",{className:"flex flex-wrap gap-2",children:T.map(j=>r.jsx(N,{variant:"outline",className:"text-sm",onClick:()=>F(j),children:j},j))})]}),r.jsxs("form",{onSubmit:S,className:"flex gap-2",children:[r.jsx(We,{value:e,onChange:j=>{n(j.target.value),b&&y(null)},placeholder:"Ask questions related to your PDF...",className:"flex-1",disabled:o}),r.jsx(N,{type:"submit",disabled:o||!d||t.processing,children:o?r.jsxs(r.Fragment,{children:[d," ",r.jsx(Me,{className:"w-4 h-4 animate-spin"})," Thinking"]}):r.jsx(Dt,{className:"w-4 h-4"})}),o&&r.jsxs(N,{type:"button",variant:"destructive",onClick:k,children:[r.jsx(jt,{className:"w-4 h-4"})," Stop"]})]})]})}function At(){const[e,n]=P(Ie),[t,a]=c.useState([]),[o,l]=P(ae),[i,s]=c.useState(!1),[d,m]=c.useState(null),{toast:h}=he(),f="http://13.50.81.209:8000",u=async()=>{try{const g=localStorage.getItem("token");console.log("Fetching documents...");const w=await te.get(`${f}/api/documents`,{headers:{Authorization:`Bearer ${g}`,"Content-Type":"application/json"}});n(w.data.documents)}catch(g){console.error("Error fetching documents:",g)}};c.useEffect(()=>{u()},[t]),c.useEffect(()=>{i&&x()},[i,o]);const x=async()=>{try{const g=localStorage.getItem("token"),b=await(await fetch(`${f}/api/documents/list/`,{headers:{Authorization:`Bearer ${g}`}})).json();a(b.documents)}catch(g){console.error("Failed to fetch documentList:",g)}},v=async(g,w)=>{try{const b=localStorage.getItem("token"),y=await fetch(`${f}${g}`,{method:"GET",headers:{Authorization:`Bearer ${b}`}});if(!y.ok){h({title:"Error",description:"Failed to download, please try again later"});return}const T=await y.blob(),L=window.URL.createObjectURL(T),M=document.createElement("a");M.href=L,M.download=w,document.body.appendChild(M),M.click(),document.body.removeChild(M),window.URL.revokeObjectURL(L),h({title:"Download successful",description:"Document downloaded successfully"})}catch(b){console.error("Download failed:",b),h({title:"Error",description:"Failed to download, please try again later"})}},p=async g=>{try{const w=localStorage.getItem("token");if(!(await fetch(`${f}/api/documents/${g}/delete/`,{method:"DELETE",headers:{Authorization:`Bearer ${w}`}})).ok){h({title:"Error",description:"Failed to delete document"});return}a(t.filter(y=>y.id!==g)),h({title:"Deleted",description:"Document deleted successfully"})}catch(w){console.error("Delete failed:",w),h({title:"Error",description:"Failed to delete document"})}};return r.jsxs("div",{className:"space-y-4 p-4 border rounded-lg shadow-md ",children:[r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("h2",{className:"text-lg font-semibold text-muted-foreground",children:"Documents"}),r.jsxs(N,{variant:"outline",onClick:()=>s(!i),children:[i?"Hide Documents":"Show Documents",i?r.jsx(St,{className:"ml-2"}):r.jsx(bt,{className:"ml-2"})]})]}),i&&r.jsx("div",{className:"flex flex-col gap-3 mt-2",children:(t==null?void 0:t.length)>0?t.map(({id:g,title:w,download_url:b})=>r.jsxs("div",{className:"flex justify-between items-center p-3 border rounded-md transition",children:[r.jsx("p",{className:"text-sm truncate max-w-[60%]",title:w,children:w}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx(N,{variant:"outline",onClick:()=>v(b,w),children:r.jsx(Ct,{})}),r.jsxs(me,{open:d===g,onOpenChange:y=>m(y?g:null),children:[r.jsx(Le,{asChild:!0,children:r.jsx(N,{variant:"outline",className:"text-red-500 hover:text-red-600",onClick:y=>y.stopPropagation(),children:r.jsx(ze,{})})}),r.jsxs(fe,{className:"sm:max-w-[425px] rounded-lg shadow-lg",children:[r.jsxs(pe,{children:[r.jsx(ge,{className:"text-lg font-semibold text-primary",children:"Delete Document"}),r.jsxs(_e,{className:"text-sm text-gray-500",children:['Are you sure you want to delete "',w,'"? This action cannot be undone.']})]}),r.jsxs(ve,{className:"mt-4",children:[r.jsx(N,{variant:"outline",onClick:()=>m(null),children:"Cancel"}),r.jsx(N,{variant:"destructive",onClick:()=>p(g),children:"Delete"})]})]})]})]})]},g)):r.jsx("p",{className:"text-sm text-gray-500",children:"No documents available."})})]})}function Et(){const{toast:e}=he();mt(de??0),P(ft);const n="http://13.50.81.209:8000",t=c.useRef(null),[a,o]=c.useState(null),[l,i]=c.useState(!1),[s,d]=P(ae),m=u=>{var v;console.log("handleFileChange");const x=(v=u.target.files)==null?void 0:v[0];if(x){if(!x.type.includes("pdf")){e({variant:"destructive",title:"Invalid file type",description:"Please upload a PDF file"});return}if(a&&x.name===a.name&&x.size===a.size){e({variant:"destructive",title:"File already selected",description:"You have already selected this file"});return}u.target.value="",o(x),i(!0)}},h=async()=>{var v,p;if(!a)return;const u=new FormData;u.append("file",a);const x=localStorage.getItem("token")??"";d(g=>({...g,processing:!0,progress:0})),i(!1);try{const g=await te.post(`${n}/api/documents/upload/`,u,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${x}`}}),w=await g.data.document_id,b=await g.data.title;d(y=>({...y,documentId:w,document:b})),e({title:"Success",description:"PDF uploaded successfully"}),f(w,x)}catch(g){d(w=>({...w,processing:!1})),e({variant:"destructive",title:"Upload Failed",description:((p=(v=g.response)==null?void 0:v.data)==null?void 0:p.message)||"Something went wrong"})}},f=async(u,x)=>{d(p=>({...p,processing:!0,progress:0}));const v=setInterval(async()=>{try{const p=await te.get(`${n}/api/documents/${u}/status/`,{headers:{Authorization:`Bearer ${x}`}}),{title:g,processing_status:w,processing_progress:b}=p.data;d(y=>({...y,progress:b,document:g})),(w==="COMPLETED"||b>=100)&&(clearInterval(v),d(y=>({...y,processing:!1})),e({title:"Processing Complete",description:`Your document "${g}" is ready.`}))}catch(p){console.error("Error fetching document status:",p),clearInterval(v),d(g=>({...g,processing:!1})),e({variant:"destructive",title:"Error Fetching Status",description:"Failed to get document status."})}},5e3);return()=>clearInterval(v)};return r.jsxs(r.Fragment,{children:[r.jsxs(ne.div,{className:"flex gap-2 items-center",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.3},children:[r.jsxs("div",{className:"relative w-full",children:[r.jsx(We,{type:"file",accept:".pdf",onChange:m,ref:t,disabled:s.processing,className:"opacity-0 absolute w-full h-full cursor-pointer"}),r.jsx("div",{className:"flex items-center w-full border border-input px-3 py-2 rounded-md text-sm bg-background cursor-pointer",onClick:()=>{var u;return(u=t.current)==null?void 0:u.click()},children:a?a.name:"No file chosen"})]}),r.jsxs(N,{disabled:s.processing,onClick:()=>{var u;return(u=t.current)==null?void 0:u.click()},children:[r.jsx(Pt,{className:"w-4 h-4 mr-2"}),"Upload PDF"]})]}),r.jsx(me,{open:l,onOpenChange:i,children:r.jsxs(fe,{children:[r.jsx(pe,{children:r.jsx(ge,{children:"Confirm Upload"})}),r.jsxs("p",{className:"text-sm text-gray-600",children:["Are you sure you want to upload"," ",r.jsx("strong",{children:a==null?void 0:a.name}),"?"]}),r.jsxs(ve,{children:[r.jsx(N,{variant:"secondary",onClick:()=>{o(null),i(!1)},children:"Cancel"}),r.jsx(N,{onClick:h,disabled:s.processing,children:s.processing?"Uploading...":"Confirm Upload"})]})]})})]})}function C(e){const n=Object.prototype.toString.call(e);return e instanceof Date||typeof e=="object"&&n==="[object Date]"?new e.constructor(+e):typeof e=="number"||n==="[object Number]"||typeof e=="string"||n==="[object String]"?new Date(e):new Date(NaN)}function Rt(e,n){return e instanceof Date?new e.constructor(n):new Date(n)}const Z=43200,ke=1440;let Tt={};function It(){return Tt}function Ae(e){const n=C(e),t=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()));return t.setUTCFullYear(n.getFullYear()),+e-+t}function ee(e,n){const t=C(e),a=C(n),o=t.getTime()-a.getTime();return o<0?-1:o>0?1:o}function Lt(e){return Rt(e,Date.now())}function _t(e,n){const t=C(e),a=C(n),o=t.getFullYear()-a.getFullYear(),l=t.getMonth()-a.getMonth();return o*12+l}function Ft(e){return n=>{const a=(e?Math[e]:Math.trunc)(n);return a===0?0:a}}function Wt(e,n){return+C(e)-+C(n)}function Ot(e){const n=C(e);return n.setHours(23,59,59,999),n}function zt(e){const n=C(e),t=n.getMonth();return n.setFullYear(n.getFullYear(),t+1,0),n.setHours(23,59,59,999),n}function Ht(e){const n=C(e);return+Ot(n)==+zt(n)}function $t(e,n){const t=C(e),a=C(n),o=ee(t,a),l=Math.abs(_t(t,a));let i;if(l<1)i=0;else{t.getMonth()===1&&t.getDate()>27&&t.setDate(30),t.setMonth(t.getMonth()-o*l);let s=ee(t,a)===-o;Ht(C(e))&&l===1&&ee(e,a)===1&&(s=!1),i=o*(l-Number(s))}return i===0?0:i}function Xt(e,n,t){const a=Wt(e,n)/1e3;return Ft(t==null?void 0:t.roundingMethod)(a)}const Ut={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},Bt=(e,n,t)=>{let a;const o=Ut[e];return typeof o=="string"?a=o:n===1?a=o.one:a=o.other.replace("{{count}}",n.toString()),t!=null&&t.addSuffix?t.comparison&&t.comparison>0?"in "+a:a+" ago":a};function ce(e){return(n={})=>{const t=n.width?String(n.width):e.defaultWidth;return e.formats[t]||e.formats[e.defaultWidth]}}const Yt={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},Vt={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},qt={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Jt={date:ce({formats:Yt,defaultWidth:"full"}),time:ce({formats:Vt,defaultWidth:"full"}),dateTime:ce({formats:qt,defaultWidth:"full"})},Qt={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},Gt=(e,n,t,a)=>Qt[e];function V(e){return(n,t)=>{const a=t!=null&&t.context?String(t.context):"standalone";let o;if(a==="formatting"&&e.formattingValues){const i=e.defaultFormattingWidth||e.defaultWidth,s=t!=null&&t.width?String(t.width):i;o=e.formattingValues[s]||e.formattingValues[i]}else{const i=e.defaultWidth,s=t!=null&&t.width?String(t.width):e.defaultWidth;o=e.values[s]||e.values[i]}const l=e.argumentCallback?e.argumentCallback(n):n;return o[l]}}const Kt={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},Zt={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},en={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},tn={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},nn={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},rn={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},on=(e,n)=>{const t=Number(e),a=t%100;if(a>20||a<10)switch(a%10){case 1:return t+"st";case 2:return t+"nd";case 3:return t+"rd"}return t+"th"},an={ordinalNumber:on,era:V({values:Kt,defaultWidth:"wide"}),quarter:V({values:Zt,defaultWidth:"wide",argumentCallback:e=>e-1}),month:V({values:en,defaultWidth:"wide"}),day:V({values:tn,defaultWidth:"wide"}),dayPeriod:V({values:nn,defaultWidth:"wide",formattingValues:rn,defaultFormattingWidth:"wide"})};function q(e){return(n,t={})=>{const a=t.width,o=a&&e.matchPatterns[a]||e.matchPatterns[e.defaultMatchWidth],l=n.match(o);if(!l)return null;const i=l[0],s=a&&e.parsePatterns[a]||e.parsePatterns[e.defaultParseWidth],d=Array.isArray(s)?ln(s,f=>f.test(i)):sn(s,f=>f.test(i));let m;m=e.valueCallback?e.valueCallback(d):d,m=t.valueCallback?t.valueCallback(m):m;const h=n.slice(i.length);return{value:m,rest:h}}}function sn(e,n){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)&&n(e[t]))return t}function ln(e,n){for(let t=0;t<e.length;t++)if(n(e[t]))return t}function cn(e){return(n,t={})=>{const a=n.match(e.matchPattern);if(!a)return null;const o=a[0],l=n.match(e.parsePattern);if(!l)return null;let i=e.valueCallback?e.valueCallback(l[0]):l[0];i=t.valueCallback?t.valueCallback(i):i;const s=n.slice(o.length);return{value:i,rest:s}}}const dn=/^(\d+)(th|st|nd|rd)?/i,un=/\d+/i,hn={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},mn={any:[/^b/i,/^(a|c)/i]},fn={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},pn={any:[/1/i,/2/i,/3/i,/4/i]},gn={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},vn={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},xn={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},wn={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},yn={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},bn={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},Sn={ordinalNumber:cn({matchPattern:dn,parsePattern:un,valueCallback:e=>parseInt(e,10)}),era:q({matchPatterns:hn,defaultMatchWidth:"wide",parsePatterns:mn,defaultParseWidth:"any"}),quarter:q({matchPatterns:fn,defaultMatchWidth:"wide",parsePatterns:pn,defaultParseWidth:"any",valueCallback:e=>e+1}),month:q({matchPatterns:gn,defaultMatchWidth:"wide",parsePatterns:vn,defaultParseWidth:"any"}),day:q({matchPatterns:xn,defaultMatchWidth:"wide",parsePatterns:wn,defaultParseWidth:"any"}),dayPeriod:q({matchPatterns:yn,defaultMatchWidth:"any",parsePatterns:bn,defaultParseWidth:"any"})},jn={code:"en-US",formatDistance:Bt,formatLong:Jt,formatRelative:Gt,localize:an,match:Sn,options:{weekStartsOn:0,firstWeekContainsDate:1}};function Cn(e,n,t){const a=It(),o=(t==null?void 0:t.locale)??a.locale??jn,l=2520,i=ee(e,n);if(isNaN(i))throw new RangeError("Invalid time value");const s=Object.assign({},t,{addSuffix:t==null?void 0:t.addSuffix,comparison:i});let d,m;i>0?(d=C(n),m=C(e)):(d=C(e),m=C(n));const h=Xt(m,d),f=(Ae(m)-Ae(d))/1e3,u=Math.round((h-f)/60);let x;if(u<2)return t!=null&&t.includeSeconds?h<5?o.formatDistance("lessThanXSeconds",5,s):h<10?o.formatDistance("lessThanXSeconds",10,s):h<20?o.formatDistance("lessThanXSeconds",20,s):h<40?o.formatDistance("halfAMinute",0,s):h<60?o.formatDistance("lessThanXMinutes",1,s):o.formatDistance("xMinutes",1,s):u===0?o.formatDistance("lessThanXMinutes",1,s):o.formatDistance("xMinutes",u,s);if(u<45)return o.formatDistance("xMinutes",u,s);if(u<90)return o.formatDistance("aboutXHours",1,s);if(u<ke){const v=Math.round(u/60);return o.formatDistance("aboutXHours",v,s)}else{if(u<l)return o.formatDistance("xDays",1,s);if(u<Z){const v=Math.round(u/ke);return o.formatDistance("xDays",v,s)}else if(u<Z*2)return x=Math.round(u/Z),o.formatDistance("aboutXMonths",x,s)}if(x=$t(m,d),x<12){const v=Math.round(u/Z);return o.formatDistance("xMonths",v,s)}else{const v=x%12,p=Math.trunc(x/12);return v<3?o.formatDistance("aboutXYears",p,s):v<9?o.formatDistance("overXYears",p,s):o.formatDistance("almostXYears",p+1,s)}}function Dn(e,n){return Cn(e,Lt(e),n)}const Pn=pt({key:"conversationsState",default:[]});function Nn(){const[e,n]=P(Pn),[t,a]=P(ue),[o,l]=P(de),[i,s]=c.useState(null),[d,m]=c.useState(!1),{toast:h}=he(),f="http://13.50.81.209:8000";c.useEffect(()=>{u()},[n]);const u=async()=>{try{const p=localStorage.getItem("token"),w=await(await fetch(`${f}/api/conversations/`,{headers:{Authorization:`Bearer ${p}`}})).json();n(w.conversations)}catch(p){console.error("Failed to fetch conversations:",p)}},x=(p,g)=>{console.log("Selected conversation ID:",p),g.length>0&&l(g),a(p)},v=async p=>{try{m(!0);const g=localStorage.getItem("token"),w=await fetch(`${f}/api/conversations/${p}/delete/`,{method:"DELETE",headers:{Authorization:`Bearer ${g}`}});w.ok?(n(e.filter(b=>b.id!==p)),t===p&&(a(""),l([])),h({title:"Success",description:"Conversation deleted successfully"})):console.error("Failed to delete conversation:",await w.text())}catch(g){console.error("Error deleting conversation:",g)}finally{m(!1),s(null)}};return r.jsxs("div",{className:"space-y-4 p-4 border rounded-lg shadow-md ",children:[r.jsx("h3",{className:"text-lg font-semibold text-muted-foreground",children:"Conversation History"}),r.jsx("div",{className:"flex flex-col gap-2",children:(e==null?void 0:e.length)>0?e.map(({id:p,title:g,created_at:w,documents:b})=>r.jsxs(N,{variant:"outline",className:"justify-between text-left w-full group",onClick:()=>x(p,b.map(y=>y.id)),children:[r.jsxs("div",{className:"flex-1",children:[r.jsx("p",{className:"font-medium text-sm truncate w-full max-w-[40%]",title:g,children:g}),r.jsx("p",{className:"text-xs text-muted-foreground",children:Dn(new Date(w),{addSuffix:!0})})]}),r.jsxs(me,{open:i===p,onOpenChange:y=>s(y?p:null),children:[r.jsx(Le,{asChild:!0,children:r.jsx("span",{onClick:y=>y.stopPropagation(),className:"text-red-500 opacity-0 group-hover:opacity-100 transition-opacity",children:r.jsx(ze,{className:"h-4 w-4"})})}),r.jsxs(fe,{className:"sm:max-w-[425px] rounded-lg shadow-lg",children:[r.jsxs(pe,{children:[r.jsx(ge,{className:"text-lg font-semibold text-primary",children:"Delete Conversation"}),r.jsxs(_e,{className:"text-sm text-gray-200",children:['Are you sure you want to delete "',g,'"? This action cannot be undone.']})]}),r.jsxs(ve,{className:"mt-4",children:[r.jsx(N,{variant:"outline",onClick:()=>s(null),className:"text-primary hover:bg-primary ",disabled:d,children:"Cancel"}),r.jsx(N,{variant:"destructive",onClick:()=>v(p),className:"bg-red-600 hover:bg-red-700 text-white",disabled:d,children:d?r.jsx(wt,{}):"Delete"})]})]})]})]},p)):r.jsx("p",{className:"text-sm text-muted-foreground",children:"No conversations yet."})})]})}function Mn(e,[n,t]){return Math.min(t,Math.max(n,e))}function kn(e,n){return c.useReducer((t,a)=>n[t][a]??t,e)}var we="ScrollArea",[He,tr]=Fe(we),[An,E]=He(we),$e=c.forwardRef((e,n)=>{const{__scopeScrollArea:t,type:a="hover",dir:o,scrollHideDelay:l=600,...i}=e,[s,d]=c.useState(null),[m,h]=c.useState(null),[f,u]=c.useState(null),[x,v]=c.useState(null),[p,g]=c.useState(null),[w,b]=c.useState(0),[y,T]=c.useState(0),[L,M]=c.useState(!1),[_,H]=c.useState(!1),S=X(n,F=>d(F)),k=gt(o);return r.jsx(An,{scope:t,type:a,dir:k,scrollHideDelay:l,scrollArea:s,viewport:m,onViewportChange:h,content:f,onContentChange:u,scrollbarX:x,onScrollbarXChange:v,scrollbarXEnabled:L,onScrollbarXEnabledChange:M,scrollbarY:p,onScrollbarYChange:g,scrollbarYEnabled:_,onScrollbarYEnabledChange:H,onCornerWidthChange:b,onCornerHeightChange:T,children:r.jsx(O.div,{dir:k,...i,ref:S,style:{position:"relative","--radix-scroll-area-corner-width":w+"px","--radix-scroll-area-corner-height":y+"px",...e.style}})})});$e.displayName=we;var Xe="ScrollAreaViewport",Ue=c.forwardRef((e,n)=>{const{__scopeScrollArea:t,children:a,asChild:o,nonce:l,...i}=e,s=E(Xe,t),d=c.useRef(null),m=X(n,d,s.onViewportChange);return r.jsxs(r.Fragment,{children:[r.jsx("style",{dangerouslySetInnerHTML:{__html:`
[data-radix-scroll-area-viewport] {
  scrollbar-width: none;
  -ms-overflow-style: none;
  -webkit-overflow-scrolling: touch;
}
[data-radix-scroll-area-viewport]::-webkit-scrollbar {
  display: none;
}
:where([data-radix-scroll-area-viewport]) {
  display: flex;
  flex-direction: column;
  align-items: stretch;
}
:where([data-radix-scroll-area-content]) {
  flex-grow: 1;
}
`},nonce:l}),r.jsx(O.div,{"data-radix-scroll-area-viewport":"",...i,asChild:o,ref:m,style:{overflowX:s.scrollbarXEnabled?"scroll":"hidden",overflowY:s.scrollbarYEnabled?"scroll":"hidden",...e.style},children:zn({asChild:o,children:a},h=>r.jsx("div",{"data-radix-scroll-area-content":"",ref:s.onContentChange,style:{minWidth:s.scrollbarXEnabled?"fit-content":void 0},children:h}))})]})});Ue.displayName=Xe;var I="ScrollAreaScrollbar",ye=c.forwardRef((e,n)=>{const{forceMount:t,...a}=e,o=E(I,e.__scopeScrollArea),{onScrollbarXEnabledChange:l,onScrollbarYEnabledChange:i}=o,s=e.orientation==="horizontal";return c.useEffect(()=>(s?l(!0):i(!0),()=>{s?l(!1):i(!1)}),[s,l,i]),o.type==="hover"?r.jsx(En,{...a,ref:n,forceMount:t}):o.type==="scroll"?r.jsx(Rn,{...a,ref:n,forceMount:t}):o.type==="auto"?r.jsx(Be,{...a,ref:n,forceMount:t}):o.type==="always"?r.jsx(be,{...a,ref:n}):null});ye.displayName=I;var En=c.forwardRef((e,n)=>{const{forceMount:t,...a}=e,o=E(I,e.__scopeScrollArea),[l,i]=c.useState(!1);return c.useEffect(()=>{const s=o.scrollArea;let d=0;if(s){const m=()=>{window.clearTimeout(d),i(!0)},h=()=>{d=window.setTimeout(()=>i(!1),o.scrollHideDelay)};return s.addEventListener("pointerenter",m),s.addEventListener("pointerleave",h),()=>{window.clearTimeout(d),s.removeEventListener("pointerenter",m),s.removeEventListener("pointerleave",h)}}},[o.scrollArea,o.scrollHideDelay]),r.jsx(se,{present:t||l,children:r.jsx(Be,{"data-state":l?"visible":"hidden",...a,ref:n})})}),Rn=c.forwardRef((e,n)=>{const{forceMount:t,...a}=e,o=E(I,e.__scopeScrollArea),l=e.orientation==="horizontal",i=ie(()=>d("SCROLL_END"),100),[s,d]=kn("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return c.useEffect(()=>{if(s==="idle"){const m=window.setTimeout(()=>d("HIDE"),o.scrollHideDelay);return()=>window.clearTimeout(m)}},[s,o.scrollHideDelay,d]),c.useEffect(()=>{const m=o.viewport,h=l?"scrollLeft":"scrollTop";if(m){let f=m[h];const u=()=>{const x=m[h];f!==x&&(d("SCROLL"),i()),f=x};return m.addEventListener("scroll",u),()=>m.removeEventListener("scroll",u)}},[o.viewport,l,d,i]),r.jsx(se,{present:t||s!=="hidden",children:r.jsx(be,{"data-state":s==="hidden"?"hidden":"visible",...a,ref:n,onPointerEnter:z(e.onPointerEnter,()=>d("POINTER_ENTER")),onPointerLeave:z(e.onPointerLeave,()=>d("POINTER_LEAVE"))})})}),Be=c.forwardRef((e,n)=>{const t=E(I,e.__scopeScrollArea),{forceMount:a,...o}=e,[l,i]=c.useState(!1),s=e.orientation==="horizontal",d=ie(()=>{if(t.viewport){const m=t.viewport.offsetWidth<t.viewport.scrollWidth,h=t.viewport.offsetHeight<t.viewport.scrollHeight;i(s?m:h)}},10);return $(t.viewport,d),$(t.content,d),r.jsx(se,{present:a||l,children:r.jsx(be,{"data-state":l?"visible":"hidden",...o,ref:n})})}),be=c.forwardRef((e,n)=>{const{orientation:t="vertical",...a}=e,o=E(I,e.__scopeScrollArea),l=c.useRef(null),i=c.useRef(0),[s,d]=c.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),m=Qe(s.viewport,s.content),h={...a,sizes:s,onSizesChange:d,hasThumb:m>0&&m<1,onThumbChange:u=>l.current=u,onThumbPointerUp:()=>i.current=0,onThumbPointerDown:u=>i.current=u};function f(u,x){return Wn(u,i.current,s,x)}return t==="horizontal"?r.jsx(Tn,{...h,ref:n,onThumbPositionChange:()=>{if(o.viewport&&l.current){const u=o.viewport.scrollLeft,x=Ee(u,s,o.dir);l.current.style.transform=`translate3d(${x}px, 0, 0)`}},onWheelScroll:u=>{o.viewport&&(o.viewport.scrollLeft=u)},onDragScroll:u=>{o.viewport&&(o.viewport.scrollLeft=f(u,o.dir))}}):t==="vertical"?r.jsx(In,{...h,ref:n,onThumbPositionChange:()=>{if(o.viewport&&l.current){const u=o.viewport.scrollTop,x=Ee(u,s);l.current.style.transform=`translate3d(0, ${x}px, 0)`}},onWheelScroll:u=>{o.viewport&&(o.viewport.scrollTop=u)},onDragScroll:u=>{o.viewport&&(o.viewport.scrollTop=f(u))}}):null}),Tn=c.forwardRef((e,n)=>{const{sizes:t,onSizesChange:a,...o}=e,l=E(I,e.__scopeScrollArea),[i,s]=c.useState(),d=c.useRef(null),m=X(n,d,l.onScrollbarXChange);return c.useEffect(()=>{d.current&&s(getComputedStyle(d.current))},[d]),r.jsx(Ve,{"data-orientation":"horizontal",...o,ref:m,sizes:t,style:{bottom:0,left:l.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:l.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":le(t)+"px",...e.style},onThumbPointerDown:h=>e.onThumbPointerDown(h.x),onDragScroll:h=>e.onDragScroll(h.x),onWheelScroll:(h,f)=>{if(l.viewport){const u=l.viewport.scrollLeft+h.deltaX;e.onWheelScroll(u),Ke(u,f)&&h.preventDefault()}},onResize:()=>{d.current&&l.viewport&&i&&a({content:l.viewport.scrollWidth,viewport:l.viewport.offsetWidth,scrollbar:{size:d.current.clientWidth,paddingStart:oe(i.paddingLeft),paddingEnd:oe(i.paddingRight)}})}})}),In=c.forwardRef((e,n)=>{const{sizes:t,onSizesChange:a,...o}=e,l=E(I,e.__scopeScrollArea),[i,s]=c.useState(),d=c.useRef(null),m=X(n,d,l.onScrollbarYChange);return c.useEffect(()=>{d.current&&s(getComputedStyle(d.current))},[d]),r.jsx(Ve,{"data-orientation":"vertical",...o,ref:m,sizes:t,style:{top:0,right:l.dir==="ltr"?0:void 0,left:l.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":le(t)+"px",...e.style},onThumbPointerDown:h=>e.onThumbPointerDown(h.y),onDragScroll:h=>e.onDragScroll(h.y),onWheelScroll:(h,f)=>{if(l.viewport){const u=l.viewport.scrollTop+h.deltaY;e.onWheelScroll(u),Ke(u,f)&&h.preventDefault()}},onResize:()=>{d.current&&l.viewport&&i&&a({content:l.viewport.scrollHeight,viewport:l.viewport.offsetHeight,scrollbar:{size:d.current.clientHeight,paddingStart:oe(i.paddingTop),paddingEnd:oe(i.paddingBottom)}})}})}),[Ln,Ye]=He(I),Ve=c.forwardRef((e,n)=>{const{__scopeScrollArea:t,sizes:a,hasThumb:o,onThumbChange:l,onThumbPointerUp:i,onThumbPointerDown:s,onThumbPositionChange:d,onDragScroll:m,onWheelScroll:h,onResize:f,...u}=e,x=E(I,t),[v,p]=c.useState(null),g=X(n,S=>p(S)),w=c.useRef(null),b=c.useRef(""),y=x.viewport,T=a.content-a.viewport,L=W(h),M=W(d),_=ie(f,10);function H(S){if(w.current){const k=S.clientX-w.current.left,F=S.clientY-w.current.top;m({x:k,y:F})}}return c.useEffect(()=>{const S=k=>{const F=k.target;(v==null?void 0:v.contains(F))&&L(k,T)};return document.addEventListener("wheel",S,{passive:!1}),()=>document.removeEventListener("wheel",S,{passive:!1})},[y,v,T,L]),c.useEffect(M,[a,M]),$(v,_),$(x.content,_),r.jsx(Ln,{scope:t,scrollbar:v,hasThumb:o,onThumbChange:W(l),onThumbPointerUp:W(i),onThumbPositionChange:M,onThumbPointerDown:W(s),children:r.jsx(O.div,{...u,ref:g,style:{position:"absolute",...u.style},onPointerDown:z(e.onPointerDown,S=>{S.button===0&&(S.target.setPointerCapture(S.pointerId),w.current=v.getBoundingClientRect(),b.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",x.viewport&&(x.viewport.style.scrollBehavior="auto"),H(S))}),onPointerMove:z(e.onPointerMove,H),onPointerUp:z(e.onPointerUp,S=>{const k=S.target;k.hasPointerCapture(S.pointerId)&&k.releasePointerCapture(S.pointerId),document.body.style.webkitUserSelect=b.current,x.viewport&&(x.viewport.style.scrollBehavior=""),w.current=null})})})}),re="ScrollAreaThumb",qe=c.forwardRef((e,n)=>{const{forceMount:t,...a}=e,o=Ye(re,e.__scopeScrollArea);return r.jsx(se,{present:t||o.hasThumb,children:r.jsx(_n,{ref:n,...a})})}),_n=c.forwardRef((e,n)=>{const{__scopeScrollArea:t,style:a,...o}=e,l=E(re,t),i=Ye(re,t),{onThumbPositionChange:s}=i,d=X(n,f=>i.onThumbChange(f)),m=c.useRef(),h=ie(()=>{m.current&&(m.current(),m.current=void 0)},100);return c.useEffect(()=>{const f=l.viewport;if(f){const u=()=>{if(h(),!m.current){const x=On(f,s);m.current=x,s()}};return s(),f.addEventListener("scroll",u),()=>f.removeEventListener("scroll",u)}},[l.viewport,h,s]),r.jsx(O.div,{"data-state":i.hasThumb?"visible":"hidden",...o,ref:d,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...a},onPointerDownCapture:z(e.onPointerDownCapture,f=>{const x=f.target.getBoundingClientRect(),v=f.clientX-x.left,p=f.clientY-x.top;i.onThumbPointerDown({x:v,y:p})}),onPointerUp:z(e.onPointerUp,i.onThumbPointerUp)})});qe.displayName=re;var Se="ScrollAreaCorner",Je=c.forwardRef((e,n)=>{const t=E(Se,e.__scopeScrollArea),a=!!(t.scrollbarX&&t.scrollbarY);return t.type!=="scroll"&&a?r.jsx(Fn,{...e,ref:n}):null});Je.displayName=Se;var Fn=c.forwardRef((e,n)=>{const{__scopeScrollArea:t,...a}=e,o=E(Se,t),[l,i]=c.useState(0),[s,d]=c.useState(0),m=!!(l&&s);return $(o.scrollbarX,()=>{var f;const h=((f=o.scrollbarX)==null?void 0:f.offsetHeight)||0;o.onCornerHeightChange(h),d(h)}),$(o.scrollbarY,()=>{var f;const h=((f=o.scrollbarY)==null?void 0:f.offsetWidth)||0;o.onCornerWidthChange(h),i(h)}),m?r.jsx(O.div,{...a,ref:n,style:{width:l,height:s,position:"absolute",right:o.dir==="ltr"?0:void 0,left:o.dir==="rtl"?0:void 0,bottom:0,...e.style}}):null});function oe(e){return e?parseInt(e,10):0}function Qe(e,n){const t=e/n;return isNaN(t)?0:t}function le(e){const n=Qe(e.viewport,e.content),t=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,a=(e.scrollbar.size-t)*n;return Math.max(a,18)}function Wn(e,n,t,a="ltr"){const o=le(t),l=o/2,i=n||l,s=o-i,d=t.scrollbar.paddingStart+i,m=t.scrollbar.size-t.scrollbar.paddingEnd-s,h=t.content-t.viewport,f=a==="ltr"?[0,h]:[h*-1,0];return Ge([d,m],f)(e)}function Ee(e,n,t="ltr"){const a=le(n),o=n.scrollbar.paddingStart+n.scrollbar.paddingEnd,l=n.scrollbar.size-o,i=n.content-n.viewport,s=l-a,d=t==="ltr"?[0,i]:[i*-1,0],m=Mn(e,d);return Ge([0,i],[0,s])(m)}function Ge(e,n){return t=>{if(e[0]===e[1]||n[0]===n[1])return n[0];const a=(n[1]-n[0])/(e[1]-e[0]);return n[0]+a*(t-e[0])}}function Ke(e,n){return e>0&&e<n}var On=(e,n=()=>{})=>{let t={left:e.scrollLeft,top:e.scrollTop},a=0;return function o(){const l={left:e.scrollLeft,top:e.scrollTop},i=t.left!==l.left,s=t.top!==l.top;(i||s)&&n(),t=l,a=window.requestAnimationFrame(o)}(),()=>window.cancelAnimationFrame(a)};function ie(e,n){const t=W(e),a=c.useRef(0);return c.useEffect(()=>()=>window.clearTimeout(a.current),[]),c.useCallback(()=>{window.clearTimeout(a.current),a.current=window.setTimeout(t,n)},[t,n])}function $(e,n){const t=W(n);xe(()=>{let a=0;if(e){const o=new ResizeObserver(()=>{cancelAnimationFrame(a),a=window.requestAnimationFrame(t)});return o.observe(e),()=>{window.cancelAnimationFrame(a),o.unobserve(e)}}},[e,t])}function zn(e,n){const{asChild:t,children:a}=e;if(!t)return typeof n=="function"?n(a):n;const o=c.Children.only(a);return c.cloneElement(o,{children:typeof n=="function"?n(o.props.children):n})}var Ze=$e,Hn=Ue,$n=Je;const et=c.forwardRef(({className:e,children:n,...t},a)=>r.jsxs(Ze,{ref:a,className:J("relative overflow-hidden",e),...t,children:[r.jsx(Hn,{className:"h-full w-full rounded-[inherit]",children:n}),r.jsx(tt,{}),r.jsx($n,{})]}));et.displayName=Ze.displayName;const tt=c.forwardRef(({className:e,orientation:n="vertical",...t},a)=>r.jsx(ye,{ref:a,orientation:n,className:J("flex touch-none select-none transition-colors",n==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",n==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",e),...t,children:r.jsx(qe,{className:"relative flex-1 rounded-full bg-border"})}));tt.displayName=ye.displayName;var je="Avatar",[Xn,nr]=Fe(je),[Un,nt]=Xn(je),rt=c.forwardRef((e,n)=>{const{__scopeAvatar:t,...a}=e,[o,l]=c.useState("idle");return r.jsx(Un,{scope:t,imageLoadingStatus:o,onImageLoadingStatusChange:l,children:r.jsx(O.span,{...a,ref:n})})});rt.displayName=je;var ot="AvatarImage",at=c.forwardRef((e,n)=>{const{__scopeAvatar:t,src:a,onLoadingStatusChange:o=()=>{},...l}=e,i=nt(ot,t),s=Bn(a,l.referrerPolicy),d=W(m=>{o(m),i.onImageLoadingStatusChange(m)});return xe(()=>{s!=="idle"&&d(s)},[s,d]),s==="loaded"?r.jsx(O.img,{...l,ref:n,src:a}):null});at.displayName=ot;var st="AvatarFallback",lt=c.forwardRef((e,n)=>{const{__scopeAvatar:t,delayMs:a,...o}=e,l=nt(st,t),[i,s]=c.useState(a===void 0);return c.useEffect(()=>{if(a!==void 0){const d=window.setTimeout(()=>s(!0),a);return()=>window.clearTimeout(d)}},[a]),i&&l.imageLoadingStatus!=="loaded"?r.jsx(O.span,{...o,ref:n}):null});lt.displayName=st;function Bn(e,n){const[t,a]=c.useState("idle");return xe(()=>{if(!e){a("error");return}let o=!0;const l=new window.Image,i=s=>()=>{o&&a(s)};return a("loading"),l.onload=i("loaded"),l.onerror=i("error"),l.src=e,n&&(l.referrerPolicy=n),()=>{o=!1}},[e,n]),t}var it=rt,ct=at,dt=lt;const Ce=c.forwardRef(({className:e,...n},t)=>r.jsx(it,{ref:t,className:J("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",e),...n}));Ce.displayName=it.displayName;const Yn=c.forwardRef(({className:e,...n},t)=>r.jsx(ct,{ref:t,className:J("aspect-square h-full w-full",e),...n}));Yn.displayName=ct.displayName;const Vn=c.forwardRef(({className:e,...n},t)=>r.jsx(dt,{ref:t,className:J("flex h-full w-full items-center justify-center rounded-full bg-muted",e),...n}));Vn.displayName=dt.displayName;const qn=({progress:e})=>{const n=Math.min(100,Math.max(0,e));return r.jsxs("div",{className:"flex items-center ml-2 gap-2",children:[r.jsx("div",{className:"relative h-2 w-20 bg-muted rounded-full overflow-hidden",children:r.jsx("div",{className:"absolute top-0 left-0 h-full bg-primary rounded-full transition-all duration-300 ease-out",style:{width:`${n}%`}})}),r.jsxs("span",{className:"text-xs font-medium text-muted-foreground",children:[Math.round(n),"%"]})]})},Jn=({message:e,index:n,isLast:t})=>{const a=e.role==="assistant";return r.jsxs(ne.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:n*.1},className:`flex gap-3 ${a?"bg-muted/50 p-4 rounded-lg":""}`,children:[r.jsx(Ce,{className:"h-8 w-8",children:a?r.jsx(Oe,{className:"h-4 w-4"}):r.jsx(Nt,{className:"h-4 w-4"})}),r.jsx(ne.div,{className:"flex-1",initial:{scale:.95},animate:{scale:1},transition:{duration:.2},children:e.type==="document_added"?r.jsxs("p",{style:{whiteSpace:"pre-wrap"},className:"text-sm leading-relaxed",children:["ðŸ“„ ",e.content]}):r.jsx("p",{style:{whiteSpace:"pre-wrap"},className:"text-sm leading-relaxed",children:e.content})})]})};function Qn(){const[e,n]=P(Re),[t,a]=P(ae),o=c.useRef(null),l=c.useRef(null),[i,s]=c.useState(!1),[d,m]=P(ue),h="http://13.50.81.209:8000",f=()=>{var v;(v=o.current)==null||v.scrollIntoView({behavior:"smooth"}),s(!1)},u=async()=>{var v;if(d)try{console.log("ðŸš€ Fetching messages for:",d);const p=localStorage.getItem("token"),w=await(await fetch(`${h}/api/conversations/${d}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:p?`Bearer ${p}`:""}})).json();if((v=w.conversation)!=null&&v.timeline){const b=w.conversation.timeline.filter(y=>y.type==="message").map(y=>({role:y.role,content:y.content}));n(b)}}catch(p){console.error("Error fetching messages:",p)}};c.useEffect(()=>{d?u():n([])},[d]);const x=()=>{if(!l.current)return;const{scrollTop:v,scrollHeight:p,clientHeight:g}=l.current;s(v+g<p-50)};return c.useEffect(()=>{i||f()},[e]),c.useEffect(()=>{const v=l.current;if(v)return v.addEventListener("scroll",x),()=>v.removeEventListener("scroll",x)},[]),r.jsxs("div",{className:"relative",children:[r.jsx(et,{ref:l,className:"min-h-[200px] pr-4 overflow-y-auto max-h-[60vh]",children:r.jsxs("div",{className:"space-y-4 flex-1",children:[e.map((v,p)=>r.jsx(Jn,{message:v,index:p,isLast:p===e.length-1},p)),t.processing&&r.jsxs(ne.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},className:"flex gap-3 bg-muted/50 p-4 rounded-lg",children:[r.jsx(Ce,{className:"h-8 w-8",children:r.jsx(Oe,{className:"h-4 w-4"})}),r.jsxs("div",{className:"flex items-center",children:[r.jsx("span",{className:"text-sm text-muted-foreground",children:(t==null?void 0:t.document)||"Processing..."}),r.jsx(qn,{progress:(t==null?void 0:t.progress)||0})]})]}),r.jsx("div",{ref:o})," "]})}),i&&r.jsx(N,{onClick:f,className:"fixed bottom-4 right-4 p-2 bg-gray-800 text-white rounded-full shadow-lg",children:r.jsx(yt,{className:"w-5 h-5"})})]})}function rr(){const e=Te(vt),n=xt();return c.useEffect(()=>{e||n("/auth")},[e]),e?r.jsx("div",{className:"container mx-auto px-4 py-8",children:r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[r.jsxs("div",{className:"md:col-span-2 space-y-6 h-[75vh] flex flex-col justify-between",children:[r.jsx(Et,{}),r.jsx(Qn,{}),r.jsx(kt,{})]}),r.jsxs("div",{className:"space-y-6 mt-[50px] md:mt-0 md:overflow-y-auto md:max-h-[78vh]",children:[r.jsx(At,{}),r.jsx(Nn,{})]})]})}):null}export{rr as default};
